/*! videojs-record v1.6.1
* https://github.com/collab-project/videojs-record
* Copyright (c) 2014-2017 - Licensed MIT */

!function(a,b){"function"==typeof define&&define.amd?define(["videojs"],b):"object"==typeof module&&module.exports?module.exports=b(require("video.js")):a.returnExports=b(a.videojs)}(this,function(a){a.LamejsEngine=a.extend(a.RecordBase,{setup:function(a,b,c){this.inputStream=a,this.mediaType=b,this.debug=c;var d={debug:this.debug,sampleRate:this.sampleRate};this.audioContext=new AudioContext,this.audioSourceNode=this.audioContext.createMediaStreamSource(this.inputStream),this.processor=this.audioContext.createScriptProcessor(16384,1,1),d.sampleRate=this.audioContext.sampleRate,this.engine=new Worker(this.audioWorkerURL),this.engine.onmessage=this.onWorkerMessage.bind(this),this.engine.postMessage({cmd:"init",config:d})},start:function(){this.processor.onaudioprocess=this.onAudioProcess.bind(this),this.audioSourceNode.connect(this.processor),this.processor.connect(this.audioContext.destination)},stop:function(){this.audioSourceNode.disconnect(),this.processor.disconnect(),this.processor.onaudioprocess=null,this.engine.postMessage({cmd:"finish"})},onWorkerMessage:function(a){switch(a.data.cmd){case"end":this.onStopRecording(new Blob(a.data.buf,{type:"audio/mp3"}));break;case"error":this.player().trigger("error",a.data.error);break;default:this.player().trigger("error",a.data)}},onAudioProcess:function(a){var b=a.inputBuffer.getChannelData(0);this.engine.postMessage({cmd:"encode",buf:b})}})});