/*! videojs-wavesurfer v1.3.6
* https://github.com/collab-project/videojs-wavesurfer
* Copyright (c) Collab 2014-2017 - Licensed MIT */

!function(e,i){"function"==typeof define&&define.amd?define(["video.js","wavesurfer"],i):"object"==typeof module&&module.exports?module.exports=i(require("video.js"),require("wavesurfer.js")):e.returnExports=i(e.videojs,e.WaveSurfer)}(this,function(e,i){var t=e.getComponent("Component");e.Waveform=e.extend(t,{constructor:function(e,r){if(t.call(this,e,r),this.waveReady=!1,this.waveFinished=!1,this.liveMode=!1,this.debug="true"===this.options_.options.debug.toString(),this.msDisplayMax=parseFloat(this.options_.options.msDisplayMax),"live"===this.options_.options.src)try{this.microphone=Object.create(i.Microphone),this.microphone.on("deviceError",this.onWaveError.bind(this)),this.liveMode=!0,this.waveReady=!0,this.log("wavesurfer.js microphone plugin enabled.")}catch(e){this.onWaveError("Could not find wavesurfer.js microphone plugin!")}this.player().one("ready",this.setupUI.bind(this))},setupUI:function(){if(this.player().bigPlayButton.hide(),!0===this.player().usingNativeControls_&&void 0!==this.player().tech_.el_&&(this.player().tech_.el_.controls=!1),this.player().currentSrc=function(){return"videojs-wavesurfer"},this.player().options_.controls){this.player().controlBar.show(),this.player().controlBar.el().style.display="flex",this.player().controlBar.progressControl.hide(),this.player().on("userinactive",function(e){this.player().userActive(!0)});for(var e,t=[this.player().controlBar.currentTimeDisplay,this.player().controlBar.timeDivider,this.player().controlBar.durationDisplay],r=0;r<t.length;r++)void 0!==(e=t[r])&&(e.el().style.display="block",e.show());void 0!==this.player().controlBar.remainingTimeDisplay&&this.player().controlBar.remainingTimeDisplay.hide(),void 0!==this.player().controlBar.timeDivider&&(this.player().controlBar.timeDivider.el().style.textAlign="center",this.player().controlBar.timeDivider.el().style.width="2em"),this.liveMode||this.player().controlBar.playToggle.hide()}this.surfer=Object.create(i),this.surfer.on("error",this.onWaveError.bind(this)),this.surfer.on("finish",this.onWaveFinish.bind(this)),this.surferReady=this.onWaveReady.bind(this),this.surferProgress=this.onWaveProgress.bind(this),this.surferSeek=this.onWaveSeek.bind(this),this.liveMode||this.setupPlaybackEvents(!0),this.player().on("play",this.onPlay.bind(this)),this.player().on("pause",this.onPause.bind(this)),this.player().on("volumechange",this.onVolumeChange.bind(this)),this.player().on("fullscreenchange",this.onScreenChange.bind(this)),this.startPlayers()},setupPlaybackEvents:function(e){!1===e?(this.surfer.un("ready",this.surferReady),this.surfer.un("audioprocess",this.surferProgress),this.surfer.un("seek",this.surferSeek)):!0===e&&(this.surfer.on("ready",this.surferReady),this.surfer.on("audioprocess",this.surferProgress),this.surfer.on("seek",this.surferSeek))},startPlayers:function(){var e=this.options_.options;this.initialize(e),void 0!==e.src?void 0===this.microphone?(this.player().loadingSpinner.show(),this.load(e.src)):(this.player().loadingSpinner.hide(),e.wavesurfer=this.surfer,this.microphone.init(e)):this.player().loadingSpinner.hide()},initialize:function(e){this.originalHeight=this.player().options_.height;var i=this.player().controlBar.height();!0===this.player().options_.controls&&0===i&&(i=30),void 0===e.container&&(e.container=this.el()),void 0===e.waveformHeight?e.height=this.player().height()-i:e.height=e.waveformHeight,e.splitChannels&&!0===e.splitChannels&&(e.height/=2),this.surfer.init(e)},load:function(e){e instanceof Blob||e instanceof File?(this.log("Loading object: "+e),this.surfer.loadBlob(e)):(this.log("Loading URL: "+e),this.surfer.load(e))},play:function(){this.liveMode?this.microphone.active?(this.log("Resume microphone"),this.microphone.play()):(this.log("Start microphone"),this.microphone.start()):(this.log("Start playback"),this.player().play(),this.surfer.play())},pause:function(){this.liveMode?(this.log("Pause microphone"),this.microphone.pause()):(this.log("Pause playback"),this.waveFinished?this.waveFinished=!1:this.surfer.pause(),this.setCurrentTime())},destroy:function(){this.log("Destroying plugin"),this.liveMode&&this.microphone&&(this.log("Destroying microphone"),this.microphone.destroy()),this.surfer.destroy(),this.player().dispose()},setVolume:function(e){void 0!==e&&(this.log("Changing volume to: "+e),this.surfer.setVolume(e))},exportImage:function(e,i){return this.surfer.exportImage(e,i)},log:function(i,t){!0===this.debug&&("error"===t?e.log.error(i):"warn"===t?e.log.warn(i):e.log(i))},getCurrentTime:function(){var e=this.surfer.getCurrentTime();return e=isNaN(e)?0:e},setCurrentTime:function(e,i){void 0===e&&(e=this.surfer.getCurrentTime()),void 0===i&&(i=this.surfer.getDuration()),e=isNaN(e)?0:e,i=isNaN(i)?0:i;var t=Math.min(e,i);this.player().controlBar.currentTimeDisplay.formattedTime_=this.player().controlBar.currentTimeDisplay.contentEl().lastChild.textContent=this.formatTime(t,i)},getDuration:function(){var e=this.surfer.getDuration();return e=isNaN(e)?0:e},setDuration:function(e){void 0===e&&(e=this.surfer.getDuration()),e=isNaN(e)?0:e,this.player().controlBar.durationDisplay.formattedTime_=this.player().controlBar.durationDisplay.contentEl().lastChild.textContent=this.formatTime(e,e)},onWaveReady:function(){this.waveReady=!0,this.waveFinished=!1,this.liveMode=!1,this.log("Waveform is ready"),this.player().trigger("waveReady"),this.setCurrentTime(),this.setDuration(),this.player().controlBar.playToggle.show(),this.player().loadingSpinner.hide(),this.player().options_.autoplay&&this.play()},onWaveFinish:function(){this.log("Finished playback"),this.player().trigger("playbackFinish"),this.player().paused()||(this.player().options_.loop?(this.surfer.stop(),this.play()):(this.waveFinished=!0,this.player().pause()))},onWaveProgress:function(e){this.setCurrentTime()},onWaveSeek:function(){this.setCurrentTime()},onPlay:function(){this.waveReady&&this.play()},onPause:function(){this.pause()},onVolumeChange:function(){var e=this.player().volume();this.player().muted()&&(e=0),this.setVolume(e)},onScreenChange:function(){var e;if(e=this.player().isFullscreen()?window.outerHeight:this.originalHeight,this.waveReady){if(this.liveMode&&!this.microphone.active)return;this.surfer.drawer.destroy(),this.surfer.params.height=e-this.player().controlBar.height(),this.surfer.createDrawer(),this.surfer.drawBuffer(),this.surfer.drawer.progress(this.surfer.backend.getPlayedPercents())}},onWaveError:function(e){this.log(e,"error"),this.player().trigger("error",e)},formatTime:function(e,i){e=e<0?0:e,i=i||e;var t=Math.floor(e%60),r=Math.floor(e/60%60),s=Math.floor(e/3600),o=Math.floor(i/60%60),n=Math.floor(i/3600),a=Math.floor(1e3*(e-t));return(isNaN(e)||e===1/0)&&(s=r=t=a="-"),i>0&&i<this.msDisplayMax?(a<100&&(a=a<10?"00"+a:"0"+a),a=":"+a):a="",s=s>0||n>0?s+":":"",r=((s||o>=10)&&r<10?"0"+r:r)+":",t=t<10?"0"+t:t,s+r+t+a}});var r=function(){var e={className:"vjs-waveform",tabIndex:0};return t.prototype.createEl("div",e)},s={debug:!1,msDisplayMax:3},o=function(i){var t=e.mergeOptions(s,i),o=this;o.waveform=new e.Waveform(o,{el:r(),options:t}),o.el().appendChild(o.waveform.el())},n=e.plugin;return"function"==typeof e.registerPlugin&&(n=e.registerPlugin),n("wavesurfer",o),o});